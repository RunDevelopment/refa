<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>refa - v0.6.0</title>
	<meta name="description" content="Documentation for refa - v0.6.0">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">refa - v0.6.0</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>refa - v0.6.0</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#regular-expressions-and-finite-automata-refa" id="regular-expressions-and-finite-automata-refa" style="color: inherit; text-decoration: none;">
					<h1>Regular Expressions and Finite Automata (refa)</h1>
				</a>
				<p><a href="https://github.com/RunDevelopment/refa/actions"><img src="https://github.com/RunDevelopment/refa/workflows/Node.js%20CI/badge.svg" alt="Actions Status"></a>
				<a href="https://www.npmjs.com/package/refa"><img src="https://img.shields.io/npm/v/refa" alt="npm"></a></p>
				<p>A library for regular expressions (RE) and finite automata (FA) in the context of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp">Javascript RegExp</a>.</p>
				<a href="#about" id="about" style="color: inherit; text-decoration: none;">
					<h2>About</h2>
				</a>
				<p>This is a general library for <a href="https://en.wikipedia.org/wiki/Deterministic_finite_automaton">DFA</a>, <a href="https://en.wikipedia.org/wiki/Nondeterministic_finite_automaton">NFA</a>, and REs of <a href="https://en.wikipedia.org/wiki/Induction_of_regular_languages">formal regular languages</a>.</p>
				<p>It also supports additional methods to easily convert from JS RegExp to the internal RE AST and vice versa.</p>
				<p><strong>At this point in time, the library is still in development and partially incomplete!</strong></p>
				<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
					<h2>Installation</h2>
				</a>
				<p>Get refa from NPM:</p>
				<pre><code><span style="color: #001080">npm</span><span style="color: #000000"> </span><span style="color: #001080">i</span><span style="color: #000000"> --</span><span style="color: #001080">save</span><span style="color: #000000"> </span><span style="color: #001080">refa</span>
</code></pre>
				<p>or</p>
				<pre><code><span style="color: #001080">yarn</span><span style="color: #000000"> </span><span style="color: #001080">add</span><span style="color: #000000"> </span><span style="color: #001080">refa</span>
</code></pre>
				<a href="#features" id="features" style="color: inherit; text-decoration: none;">
					<h2>Features</h2>
				</a>
				<ul>
					<li><p>Conversions</p>
						<ul>
							<li>RE to NFA (<em>assertions are not implemented yet</em>)</li>
							<li>NFA to DFA and DFA to NFA</li>
							<li>NFA to RE and DFA to RE</li>
						</ul>
					</li>
					<li><p>DFA and NFA operations</p>
						<ul>
							<li>Construction from other FA, the intersection of two FA, or a finite set of words</li>
							<li>Print internal representation in a human-readable form</li>
							<li>Test whether a word is accepted</li>
							<li>Test whether the language of an FA is the empty set/a finite set</li>
							<li>Accept all prefixes of a language</li>
						</ul>
					</li>
					<li><p>DFA specific operations</p>
						<ul>
							<li>Minimization</li>
							<li>Complement</li>
							<li>Structural equality</li>
						</ul>
					</li>
					<li><p>NFA specific operations</p>
						<ul>
							<li>Union and Concatenation with other FA</li>
							<li>Quantification</li>
							<li>Reverse</li>
							<li>Accept all suffixes of a language</li>
						</ul>
					</li>
					<li><p>JavaScript RegExp</p>
						<ul>
							<li>RegExp to RE and RE to RegExp<ul>
									<li>All flags are fully supported</li>
									<li>Unicode properties</li>
									<li>Change flags</li>
									<li>Limited support for simple backreferences</li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
				<p>See the <a href="https://rundevelopment.github.io/refa/">API documentation</a> for a complete list of all currently implemented operations.</p>
				<a href="#re-ast-format" id="re-ast-format" style="color: inherit; text-decoration: none;">
					<h3>RE AST format</h3>
				</a>
				<p>refa uses its own AST format to represent regular expressions. The RE AST format is language agnostic and comparatively simple.</p>
				<p>It supports:</p>
				<ul>
					<li>Concatenation (e.g. <code>ab</code>)</li>
					<li>Alternation (e.g. <code>a|b</code>)</li>
					<li>Quantifiers (greedy and lazy) (e.g. <code>a{4,6}</code>, <code>a{2,}?</code>, <code>a?</code>, <code>a*</code>)</li>
					<li>Assertions (e.g. <code>(?=a)</code>, <code>(?&lt;!a)</code>)</li>
					<li>Characters/character sets (represented by interval sets)</li>
				</ul>
				<p>Some features like atomic groups and capturing groups are not supported (but might be added in the future).</p>
				<p>Features like backreferences and recursion will never be support because their implementation details are very specific to the underlying regex engine and cannot be represented in an language-agnostic way.</p>
				<a href="#converting-to-and-from-the-re-ast-format" id="converting-to-and-from-the-re-ast-format" style="color: inherit; text-decoration: none;">
					<h4>Converting to and from the RE AST format</h4>
				</a>
				<p>JavaScript RegExp can be converted to the RE AST format by using <code>JS.Parser</code>. <code>JS.toLiteral</code> converts into the other direction. (Note that the conversion from JS RegExp to the RE AST format is lossy (capturing groups) and sometime impossible due to the limitations of the RE AST format.)</p>
				<p>Converters for other regex dialects might be added in the future as separate packages.</p>
				<a href="#universal-characters" id="universal-characters" style="color: inherit; text-decoration: none;">
					<h3>Universal characters</h3>
				</a>
				<p>refa does not use JavaScript string represent characters or a sequence of characters. Instead it uses integers to represent characters (see the <code>Char</code> type) and arrays of numbers to represent words/strings (see the <code>Word</code> type).</p>
				<p>This means that any text encoding can be used.</p>
				<p>The <code>Words</code> namespace contains functions to convert JavaScript data into refa-compatible words and characters.</p>
				<a href="#general-limitations" id="general-limitations" style="color: inherit; text-decoration: none;">
					<h3>General limitations</h3>
				</a>
				<p>This library will never be able to support some modern features of regex engines such as <a href="https://www.rexegg.com/regex-capture.html">backreferences</a> and <a href="https://www.rexegg.com/regex-recursion.html">recursion</a> because these features, generally, cannot be be represented by a DFA or NFA.</p>
				<a href="#usage-examples" id="usage-examples" style="color: inherit; text-decoration: none;">
					<h2>Usage examples</h2>
				</a>
				<p>refa is a relatively low-level library. It only provides the basic building blocks. In the following examples, JS RegExps are used a lot so we will define a few useful helper function beforehand.</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">DFA</span><span style="color: #000000">, </span><span style="color: #001080">FiniteAutomaton</span><span style="color: #000000">, </span><span style="color: #001080">JS</span><span style="color: #000000">, </span><span style="color: #001080">NFA</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;refa&quot;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">toNFA</span><span style="color: #000000">(</span><span style="color: #001080">regex</span><span style="color: #000000">: </span><span style="color: #267F99">RegExp</span><span style="color: #000000">): </span><span style="color: #267F99">NFA</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">expression</span><span style="color: #000000">, </span><span style="color: #0070C1">maxCharacter</span><span style="color: #000000"> } = </span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #001080">Parser</span><span style="color: #000000">.</span><span style="color: #795E26">fromLiteral</span><span style="color: #000000">(</span><span style="color: #001080">regex</span><span style="color: #000000">).</span><span style="color: #795E26">parse</span><span style="color: #000000">();</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0070C1">NFA</span><span style="color: #000000">.</span><span style="color: #795E26">fromRegex</span><span style="color: #000000">(</span><span style="color: #001080">expression</span><span style="color: #000000">, { </span><span style="color: #001080">maxCharacter</span><span style="color: #000000"> });</span>
<span style="color: #000000">}</span>
<span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">toDFA</span><span style="color: #000000">(</span><span style="color: #001080">regex</span><span style="color: #000000">: </span><span style="color: #267F99">RegExp</span><span style="color: #000000">): </span><span style="color: #267F99">DFA</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0070C1">DFA</span><span style="color: #000000">.</span><span style="color: #795E26">fromFA</span><span style="color: #000000">(</span><span style="color: #795E26">toNFA</span><span style="color: #000000">(</span><span style="color: #001080">regex</span><span style="color: #000000">));</span>
<span style="color: #000000">}</span>
<span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">toRegExp</span><span style="color: #000000">(</span><span style="color: #001080">fa</span><span style="color: #000000">: </span><span style="color: #267F99">FiniteAutomaton</span><span style="color: #000000">): </span><span style="color: #267F99">RegExp</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">literal</span><span style="color: #000000"> = </span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #795E26">toLiteral</span><span style="color: #000000">(</span><span style="color: #001080">fa</span><span style="color: #000000">.</span><span style="color: #795E26">toRegex</span><span style="color: #000000">());</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">RegExp</span><span style="color: #000000">(</span><span style="color: #001080">literal</span><span style="color: #000000">.</span><span style="color: #001080">source</span><span style="color: #000000">, </span><span style="color: #001080">literal</span><span style="color: #000000">.</span><span style="color: #001080">flags</span><span style="color: #000000">);</span>
<span style="color: #000000">}</span>
</code></pre>
				<ul>
					<li><code>toNFA</code> parses the given RegExp and constructs a new NFA from the parsed AST.</li>
					<li><code>toDFA</code> constructs a new NFA from the RegExp first and then converts that NFA into a new DFA.</li>
					<li><code>toRegex</code> takes an FA (= NFA or DFA) and converts it into a RegExp.</li>
				</ul>
				<a href="#testing-whether-a-word-is-accepted" id="testing-whether-a-word-is-accepted" style="color: inherit; text-decoration: none;">
					<h3>Testing whether a word is accepted</h3>
				</a>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">Words</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;refa&quot;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">regex</span><span style="color: #000000"> =</span><span style="color: #811F3F"> /\w</span><span style="color: #000000">+</span><span style="color: #811F3F">\d</span><span style="color: #000000">+</span><span style="color: #811F3F">/</span><span style="color: #000000">;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">nfa</span><span style="color: #000000"> = </span><span style="color: #795E26">toNFA</span><span style="color: #000000">(</span><span style="color: #001080">regex</span><span style="color: #000000">);</span>

<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">nfa</span><span style="color: #000000">.</span><span style="color: #795E26">test</span><span style="color: #000000">(</span><span style="color: #001080">Words</span><span style="color: #000000">.</span><span style="color: #795E26">fromStringToUTF16</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;abc&quot;</span><span style="color: #000000">)));</span>
<span style="color: #008000">// =&gt; false</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">nfa</span><span style="color: #000000">.</span><span style="color: #795E26">test</span><span style="color: #000000">(</span><span style="color: #001080">Words</span><span style="color: #000000">.</span><span style="color: #795E26">fromStringToUTF16</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;123&quot;</span><span style="color: #000000">)));</span>
<span style="color: #008000">// =&gt; true</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">nfa</span><span style="color: #000000">.</span><span style="color: #795E26">test</span><span style="color: #000000">(</span><span style="color: #001080">Words</span><span style="color: #000000">.</span><span style="color: #795E26">fromStringToUTF16</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;abc123&quot;</span><span style="color: #000000">)));</span>
<span style="color: #008000">// =&gt; true</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">nfa</span><span style="color: #000000">.</span><span style="color: #795E26">test</span><span style="color: #000000">(</span><span style="color: #001080">Words</span><span style="color: #000000">.</span><span style="color: #795E26">fromStringToUTF16</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;123abc&quot;</span><span style="color: #000000">)));</span>
<span style="color: #008000">// =&gt; false</span>
</code></pre>
				<a href="#finding-the-intersection-of-two-js-regexps" id="finding-the-intersection-of-two-js-regexps" style="color: inherit; text-decoration: none;">
					<h3>Finding the intersection of two JS RegExps</h3>
				</a>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">regex1</span><span style="color: #000000"> =</span><span style="color: #811F3F"> /a</span><span style="color: #000000">+</span><span style="color: #811F3F">B</span><span style="color: #000000">+</span><span style="color: #811F3F">c</span><span style="color: #000000">+</span><span style="color: #811F3F">/</span><span style="color: #0000FF">i</span><span style="color: #000000">;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">regex2</span><span style="color: #000000"> =</span><span style="color: #811F3F"> /Ab</span><span style="color: #000000">*</span><span style="color: #811F3F">C\d</span><span style="color: #000000">?</span><span style="color: #811F3F">/</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">intersection</span><span style="color: #000000"> = </span><span style="color: #0070C1">NFA</span><span style="color: #000000">.</span><span style="color: #795E26">fromIntersection</span><span style="color: #000000">(</span><span style="color: #795E26">toNFA</span><span style="color: #000000">(</span><span style="color: #001080">regex1</span><span style="color: #000000">), </span><span style="color: #795E26">toNFA</span><span style="color: #000000">(</span><span style="color: #001080">regex2</span><span style="color: #000000">));</span>

<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #795E26">toRegExp</span><span style="color: #000000">(</span><span style="color: #001080">intersection</span><span style="color: #000000">));</span>
<span style="color: #008000">// =&gt; /Ab+C/</span>
</code></pre>
				<a href="#finding-the-complement-of-a-js-regexp" id="finding-the-complement-of-a-js-regexp" style="color: inherit; text-decoration: none;">
					<h3>Finding the complement of a JS RegExp</h3>
				</a>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">regex</span><span style="color: #000000"> =</span><span style="color: #811F3F"> /a</span><span style="color: #000000">+</span><span style="color: #811F3F">b</span><span style="color: #000000">*</span><span style="color: #811F3F">/</span><span style="color: #0000FF">i</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">dfa</span><span style="color: #000000"> = </span><span style="color: #795E26">toDFA</span><span style="color: #000000">(</span><span style="color: #001080">regex</span><span style="color: #000000">);</span>
<span style="color: #001080">dfa</span><span style="color: #000000">.</span><span style="color: #795E26">complement</span><span style="color: #000000">();</span>

<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #795E26">toRegExp</span><span style="color: #000000">(</span><span style="color: #001080">dfa</span><span style="color: #000000">));</span>
<span style="color: #008000">// =&gt; /(?:(?:[^A]|A+(?:[^AB]|B+[^B]))[^]*)?/i</span>
</code></pre>
				<a href="#converting-a-js-regexp-to-an-nfa" id="converting-a-js-regexp-to-an-nfa" style="color: inherit; text-decoration: none;">
					<h3>Converting a JS RegExp to an NFA</h3>
				</a>
				<p>In the above examples, we have been using the <code>toNFA</code> helper function to parse and convert RegExps. This function assumes that the given RegExp is a pure regular expression without assertions and backreferences and will throw an error if the assumption is not met.</p>
				<p>However, the JS parser and <code>NFA.fromRegex</code> provide some options to work around and even solve this problem.</p>
				<a href="#backreferences" id="backreferences" style="color: inherit; text-decoration: none;">
					<h4>Backreferences</h4>
				</a>
				<p>Firstly, the parser will automatically resolve simple backreferences. Even <code>toNFA</code> will do this since it&#39;s on by default:</p>
				<pre><code class="language-ts"><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #795E26">toRegExp</span><span style="color: #000000">(</span><span style="color: #795E26">toNFA</span><span style="color: #000000">(</span><span style="color: #811F3F">/</span><span style="color: #D16969">(</span><span style="color: #811F3F">&quot;</span><span style="color: #EE0000">|</span><span style="color: #811F3F">&#039;</span><span style="color: #D16969">)</span><span style="color: #811F3F">.</span><span style="color: #000000">*?</span><span style="color: #0000FF">\1</span><span style="color: #811F3F">/</span><span style="color: #000000">)));</span>
<span style="color: #008000">// =&gt; /&quot;.*&quot;|&#039;.*&#039;/i</span>
</code></pre>
				<p>But it will throw an error for non-trivial backreferences that cannot be resolved:</p>
				<pre><code class="language-ts"><span style="color: #795E26">toNFA</span><span style="color: #000000">(</span><span style="color: #811F3F">/</span><span style="color: #D16969">(</span><span style="color: #811F3F">#</span><span style="color: #000000">+</span><span style="color: #D16969">)</span><span style="color: #811F3F">.</span><span style="color: #000000">*</span><span style="color: #0000FF">\1</span><span style="color: #EE0000">|</span><span style="color: #811F3F">foo/</span><span style="color: #000000">);</span>
<span style="color: #008000">// Error: Backreferences are not supported.</span>
</code></pre>
				<p>The only way to parse the RegExp despite unresolvable backreferences is to remove the backreferences. This means that the result will be imperfect but it might still be useful.</p>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">regex</span><span style="color: #000000"> =</span><span style="color: #811F3F"> /</span><span style="color: #D16969">(</span><span style="color: #811F3F">#</span><span style="color: #000000">+</span><span style="color: #D16969">)</span><span style="color: #811F3F">.</span><span style="color: #000000">*</span><span style="color: #0000FF">\1</span><span style="color: #EE0000">|</span><span style="color: #811F3F">foo/</span><span style="color: #000000">;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">parseResult</span><span style="color: #000000"> = </span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #001080">Parser</span><span style="color: #000000">.</span><span style="color: #795E26">fromLiteral</span><span style="color: #000000">(</span><span style="color: #001080">regex</span><span style="color: #000000">).</span><span style="color: #795E26">parse</span><span style="color: #000000">({ </span><span style="color: #001080">backreferences:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;disable&quot;</span><span style="color: #000000"> });</span>

<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #795E26">toLiteral</span><span style="color: #000000">(</span><span style="color: #001080">parseResult</span><span style="color: #000000">.</span><span style="color: #001080">expression</span><span style="color: #000000">));</span>
<span style="color: #008000">// =&gt; { source: &#039;foo&#039;, flags: &#039;&#039; }</span>
</code></pre>
				<p>Note that the <code>foo</code> alternative is kept because it is completely unaffected by the unresolvable backreferences.</p>
				<a href="#assertions" id="assertions" style="color: inherit; text-decoration: none;">
					<h4>Assertions</h4>
				</a>
				<p>While the parser and AST format can handle assertions, the NFA construction cannot.</p>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">regex</span><span style="color: #000000"> =</span><span style="color: #811F3F"> /</span><span style="color: #EE0000">\b</span><span style="color: #D16969">(?!</span><span style="color: #811F3F">\d</span><span style="color: #D16969">)</span><span style="color: #811F3F">\w</span><span style="color: #000000">+</span><span style="color: #EE0000">\b|</span><span style="color: #811F3F">-&gt;/</span><span style="color: #000000">;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">expression</span><span style="color: #000000">, </span><span style="color: #0070C1">maxCharacter</span><span style="color: #000000"> } = </span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #001080">Parser</span><span style="color: #000000">.</span><span style="color: #795E26">fromLiteral</span><span style="color: #000000">(</span><span style="color: #001080">regex</span><span style="color: #000000">).</span><span style="color: #795E26">parse</span><span style="color: #000000">();</span>

<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #795E26">toLiteral</span><span style="color: #000000">(</span><span style="color: #001080">expression</span><span style="color: #000000">));</span>
<span style="color: #008000">// =&gt; { source: &#039;\\b(?!\\d)\\w+\\b|-&gt;&#039;, flags: &#039;i&#039; }</span>

<span style="color: #0070C1">NFA</span><span style="color: #000000">.</span><span style="color: #795E26">fromRegex</span><span style="color: #000000">(</span><span style="color: #001080">expression</span><span style="color: #000000">, { </span><span style="color: #001080">maxCharacter</span><span style="color: #000000"> });</span>
<span style="color: #008000">// Error: Assertions are not supported yet.</span>
</code></pre>
				<p>Similarly to backreferences, we can let the parser remove them:</p>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">regex</span><span style="color: #000000"> =</span><span style="color: #811F3F"> /</span><span style="color: #EE0000">\b</span><span style="color: #D16969">(?!</span><span style="color: #811F3F">\d</span><span style="color: #D16969">)</span><span style="color: #811F3F">\w</span><span style="color: #000000">+</span><span style="color: #EE0000">\b|</span><span style="color: #811F3F">-&gt;/</span><span style="color: #000000">;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">expression</span><span style="color: #000000">, </span><span style="color: #0070C1">maxCharacter</span><span style="color: #000000"> } = </span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #001080">Parser</span><span style="color: #000000">.</span><span style="color: #795E26">fromLiteral</span><span style="color: #000000">(</span><span style="color: #001080">regex</span><span style="color: #000000">).</span><span style="color: #795E26">parse</span><span style="color: #000000">({ </span><span style="color: #001080">assertions:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;disable&quot;</span><span style="color: #000000"> });</span>

<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #795E26">toLiteral</span><span style="color: #000000">(</span><span style="color: #001080">expression</span><span style="color: #000000">));</span>
<span style="color: #008000">// =&gt; { source: &#039;-&gt;&#039;, flags: &#039;i&#039; }</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">nfa</span><span style="color: #000000"> = </span><span style="color: #0070C1">NFA</span><span style="color: #000000">.</span><span style="color: #795E26">fromRegex</span><span style="color: #000000">(</span><span style="color: #001080">expression</span><span style="color: #000000">, { </span><span style="color: #001080">maxCharacter</span><span style="color: #000000"> });</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #795E26">toRegExp</span><span style="color: #000000">(</span><span style="color: #001080">nfa</span><span style="color: #000000">));</span>
<span style="color: #008000">// =&gt; /-&gt;/i</span>
</code></pre>
				<details>
					<p>Or we can let the NFA construction method remove them:</p>
					<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">regex</span><span style="color: #000000"> =</span><span style="color: #811F3F"> /</span><span style="color: #EE0000">\b</span><span style="color: #D16969">(?!</span><span style="color: #811F3F">\d</span><span style="color: #D16969">)</span><span style="color: #811F3F">\w</span><span style="color: #000000">+</span><span style="color: #EE0000">\b|</span><span style="color: #811F3F">-&gt;/</span><span style="color: #000000">;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">expression</span><span style="color: #000000">, </span><span style="color: #0070C1">maxCharacter</span><span style="color: #000000"> } = </span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #001080">Parser</span><span style="color: #000000">.</span><span style="color: #795E26">fromLiteral</span><span style="color: #000000">(</span><span style="color: #001080">regex</span><span style="color: #000000">).</span><span style="color: #795E26">parse</span><span style="color: #000000">();</span>

<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #795E26">toLiteral</span><span style="color: #000000">(</span><span style="color: #001080">expression</span><span style="color: #000000">));</span>
<span style="color: #008000">// =&gt; { source: &#039;\\b(?!\\d)\\w+\\b|-&gt;&#039;, flags: &#039;i&#039; }</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">nfa</span><span style="color: #000000"> = </span><span style="color: #0070C1">NFA</span><span style="color: #000000">.</span><span style="color: #795E26">fromRegex</span><span style="color: #000000">(</span><span style="color: #001080">expression</span><span style="color: #000000">, { </span><span style="color: #001080">maxCharacter</span><span style="color: #000000"> }, { </span><span style="color: #001080">assertions:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;disable&quot;</span><span style="color: #000000"> });</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #795E26">toRegExp</span><span style="color: #000000">(</span><span style="color: #001080">nfa</span><span style="color: #000000">));</span>
<span style="color: #008000">// =&gt; /-&gt;/i</span>
</code></pre>
					<p>Prefer using the parser to remove assertions if possible. The parser is quite clever and will optimize based on that assertions can be removed resulting in faster parse times.</p>
				</details>
				<p>However, simply removing assertions is not ideal since they are a lot more common than backreferences. To work around this, refa has AST transformers. AST transformers can make changes to a given AST. While each transformer is rather simple, they can also work together to accomplish more complex tasks. Applying and removing assertions is one such task.</p>
				<p>The details about the transformers used in this example can be found in their documentation.</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">combineTransformers</span><span style="color: #000000">, </span><span style="color: #001080">FiniteAutomaton</span><span style="color: #000000">, </span><span style="color: #001080">JS</span><span style="color: #000000">, </span><span style="color: #001080">NFA</span><span style="color: #000000">, </span><span style="color: #001080">transform</span><span style="color: #000000">, </span><span style="color: #001080">Transformers</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;refa&quot;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">toRegExp</span><span style="color: #000000">(</span><span style="color: #001080">fa</span><span style="color: #000000">: </span><span style="color: #267F99">FiniteAutomaton</span><span style="color: #000000">): </span><span style="color: #267F99">RegExp</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">literal</span><span style="color: #000000"> = </span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #795E26">toLiteral</span><span style="color: #000000">(</span><span style="color: #001080">fa</span><span style="color: #000000">.</span><span style="color: #795E26">toRegex</span><span style="color: #000000">());</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">RegExp</span><span style="color: #000000">(</span><span style="color: #001080">literal</span><span style="color: #000000">.</span><span style="color: #001080">source</span><span style="color: #000000">, </span><span style="color: #001080">literal</span><span style="color: #000000">.</span><span style="color: #001080">flags</span><span style="color: #000000">);</span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">regex</span><span style="color: #000000"> =</span><span style="color: #811F3F"> /</span><span style="color: #EE0000">\b</span><span style="color: #D16969">(?!</span><span style="color: #811F3F">\d</span><span style="color: #D16969">)</span><span style="color: #811F3F">\w</span><span style="color: #000000">+</span><span style="color: #EE0000">\b|</span><span style="color: #811F3F">-&gt;/</span><span style="color: #000000">;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">expression</span><span style="color: #000000">, </span><span style="color: #0070C1">maxCharacter</span><span style="color: #000000"> } = </span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #001080">Parser</span><span style="color: #000000">.</span><span style="color: #795E26">fromLiteral</span><span style="color: #000000">(</span><span style="color: #001080">regex</span><span style="color: #000000">).</span><span style="color: #795E26">parse</span><span style="color: #000000">();</span>

<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #795E26">toLiteral</span><span style="color: #000000">(</span><span style="color: #001080">expression</span><span style="color: #000000">));</span>
<span style="color: #008000">// =&gt; { source: &#039;\\b(?!\\d)\\w+\\b|-&gt;&#039;, flags: &#039;i&#039; }</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">transformer</span><span style="color: #000000"> = </span><span style="color: #795E26">combineTransformers</span><span style="color: #000000">([</span>
<span style="color: #000000">    </span><span style="color: #001080">Transformers</span><span style="color: #000000">.</span><span style="color: #795E26">inline</span><span style="color: #000000">(),</span>
<span style="color: #000000">    </span><span style="color: #001080">Transformers</span><span style="color: #000000">.</span><span style="color: #795E26">removeDeadBranches</span><span style="color: #000000">(),</span>
<span style="color: #000000">    </span><span style="color: #001080">Transformers</span><span style="color: #000000">.</span><span style="color: #795E26">removeUnnecessaryAssertions</span><span style="color: #000000">(),</span>
<span style="color: #000000">    </span><span style="color: #001080">Transformers</span><span style="color: #000000">.</span><span style="color: #795E26">applyAssertions</span><span style="color: #000000">(),</span>
<span style="color: #000000">]);</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">modifiedExpression</span><span style="color: #000000"> = </span><span style="color: #795E26">transform</span><span style="color: #000000">(</span><span style="color: #001080">transformer</span><span style="color: #000000">, </span><span style="color: #001080">expression</span><span style="color: #000000">);</span>

<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #795E26">toLiteral</span><span style="color: #000000">(</span><span style="color: #001080">modifiedExpression</span><span style="color: #000000">));</span>
<span style="color: #008000">// =&gt; { source: &#039;(?&lt;!\\w)[A-Z_]\\w*(?!\\w)|-&gt;&#039;, flags: &#039;i&#039; }</span>

<span style="color: #008000">// most assertions have been removed</span>
<span style="color: #008000">// the only ones left assert characters beyond the edge of the pattern, so let&#039;s remove them</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">finalExpression</span><span style="color: #000000"> = </span><span style="color: #795E26">transform</span><span style="color: #000000">(</span><span style="color: #001080">Transformers</span><span style="color: #000000">.</span><span style="color: #795E26">patternEdgeAssertions</span><span style="color: #000000">({ </span><span style="color: #001080">remove:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span><span style="color: #000000"> }), </span><span style="color: #001080">modifiedExpression</span><span style="color: #000000">);</span>

<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #0070C1">JS</span><span style="color: #000000">.</span><span style="color: #795E26">toLiteral</span><span style="color: #000000">(</span><span style="color: #001080">finalExpression</span><span style="color: #000000">));</span>
<span style="color: #008000">// =&gt; { source: &#039;[A-Z_]\\w*|-&gt;&#039;, flags: &#039;i&#039; }</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">nfa</span><span style="color: #000000"> = </span><span style="color: #0070C1">NFA</span><span style="color: #000000">.</span><span style="color: #795E26">fromRegex</span><span style="color: #000000">(</span><span style="color: #001080">finalExpression</span><span style="color: #000000">, { </span><span style="color: #001080">maxCharacter</span><span style="color: #000000"> });</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #795E26">toRegExp</span><span style="color: #000000">(</span><span style="color: #001080">nfa</span><span style="color: #000000">));</span>
<span style="color: #008000">// =&gt; /-&gt;|[A-Z_]\w*/i</span>
</code></pre>
				<p>AST transformers can handle a lot of assertions but there are limitations. Transformers cannot handle assertions that are too complex or require large-scale changes to the AST.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/dfa.html">DFA</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/js.html">JS</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/nfa.html">NFA</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/transformers.html">Transformers</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/words.html">Words</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-class tsd-has-type-parameter">
						<a href="classes/charmap.html" class="tsd-kind-icon">Char<wbr>Map</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/charset.html" class="tsd-kind-icon">Char<wbr>Set</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/dfa.html" class="tsd-kind-icon">DFA</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/nfa.html" class="tsd-kind-icon">NFA</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/toomanynodeserror.html" class="tsd-kind-icon">Too<wbr>Many<wbr>Nodes<wbr>Error</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/alternation.html" class="tsd-kind-icon">Alternation</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/assertion.html" class="tsd-kind-icon">Assertion</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/charrange.html" class="tsd-kind-icon">Char<wbr>Range</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/characterclass.html" class="tsd-kind-icon">Character<wbr>Class</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/concatenation.html" class="tsd-kind-icon">Concatenation</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/expression.html" class="tsd-kind-icon">Expression</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/faiterator.html" class="tsd-kind-icon">FAIterator</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/finiteautomaton.html" class="tsd-kind-icon">Finite<wbr>Automaton</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/intersectionoptions.html" class="tsd-kind-icon">Intersection<wbr>Options</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/nodebase.html" class="tsd-kind-icon">Node<wbr>Base</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/quantifier.html" class="tsd-kind-icon">Quantifier</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/readonlycharmap.html" class="tsd-kind-icon">Readonly<wbr>Char<wbr>Map</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/readonlydfa.html" class="tsd-kind-icon">ReadonlyDFA</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/readonlynfa.html" class="tsd-kind-icon">ReadonlyNFA</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/sourcelocation.html" class="tsd-kind-icon">Source<wbr>Location</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/toregexoptions.html" class="tsd-kind-icon">To<wbr>Regex<wbr>Options</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/transformcontext.html" class="tsd-kind-icon">Transform<wbr>Context</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/transformoptions.html" class="tsd-kind-icon">Transform<wbr>Options</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/transformer.html" class="tsd-kind-icon">Transformer</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/transitioniterable.html" class="tsd-kind-icon">Transition<wbr>Iterable</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/transitioniterablefa.html" class="tsd-kind-icon">Transition<wbr>IterableFA</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/visitnoparentnodeshandler.html" class="tsd-kind-icon">Visit<wbr>NoParent<wbr>Nodes<wbr>Handler</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/visitnodeshandler.html" class="tsd-kind-icon">Visit<wbr>Nodes<wbr>Handler</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#char" class="tsd-kind-icon">Char</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#element" class="tsd-kind-icon">Element</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="modules.html#noparent" class="tsd-kind-icon">No<wbr>Parent</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#node" class="tsd-kind-icon">Node</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#parent" class="tsd-kind-icon">Parent</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#readonlyword" class="tsd-kind-icon">Readonly<wbr>Word</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#word" class="tsd-kind-icon">Word</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#combinetransformers" class="tsd-kind-icon">combine<wbr>Transformers</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="modules.html#setparent" class="tsd-kind-icon">set<wbr>Parent</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#setsource" class="tsd-kind-icon">set<wbr>Source</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#transform" class="tsd-kind-icon">transform</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#visitnodes" class="tsd-kind-icon">visit<wbr>Nodes</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer>
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>